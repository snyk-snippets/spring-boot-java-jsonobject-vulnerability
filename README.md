# CVE-2023-5072 exploit demo app

Build:

```
mvn install -Dskip.Tests
```

Run:

```
java -jar ./target/demo-0.0.1-SNAPSHOT.jar 
```

Exploit:
```
python3 exploit.py
```

Might need to increase the `depth` parameter until JVM crashes with something like:
```
java.lang.OutOfMemoryError: Java heap space
        at java.base/java.util.Arrays.copyOf(Arrays.java:3537) ~[na:na]
        at java.base/java.lang.AbstractStringBuilder.ensureCapacityInternal(AbstractStringBuilder.java:228) ~[na:na]
        at java.base/java.lang.AbstractStringBuilder.append(AbstractStringBuilder.java:802) ~[na:na]
        at java.base/java.lang.StringBuffer.append(StringBuffer.java:425) ~[na:na]
        at java.base/java.io.StringWriter.write(StringWriter.java:77) ~[na:na]
        at org.json.JSONObject.quote(JSONObject.java:2034) ~[json-20230618.jar!/:na]
        at org.json.JSONObject.quote(JSONObject.java:2007) ~[json-20230618.jar!/:na]
        at org.json.JSONObject.write(JSONObject.java:2622) ~[json-20230618.jar!/:na]
        at org.json.JSONObject.writeValue(JSONObject.java:2540) ~[json-20230618.jar!/:na]
        at org.json.JSONArray.write(JSONArray.java:1511) ~[json-20230618.jar!/:na]
        at org.json.JSONArray.toString(JSONArray.java:1455) ~[json-20230618.jar!/:na]
        at org.json.JSONArray.toString(JSONArray.java:1418) ~[json-20230618.jar!/:na]
        at org.json.JSONObject.<init>(JSONObject.java:226) ~[json-20230618.jar!/:na]
        at org.json.JSONTokener.nextValue(JSONTokener.java:414) ~[json-20230618.jar!/:na]
        at org.json.JSONArray.<init>(JSONArray.java:105) ~[json-20230618.jar!/:na]
        at org.json.JSONTokener.nextValue(JSONTokener.java:421) ~[json-20230618.jar!/:na]
        at org.json.JSONObject.<init>(JSONObject.java:226) ~[json-20230618.jar!/:na]
        at org.json.JSONTokener.nextValue(JSONTokener.java:414) ~[json-20230618.jar!/:na]
        at org.json.JSONArray.<init>(JSONArray.java:105) ~[json-20230618.jar!/:na]
        at org.json.JSONTokener.nextValue(JSONTokener.java:421) ~[json-20230618.jar!/:na]
        at org.json.JSONObject.<init>(JSONObject.java:226) ~[json-20230618.jar!/:na]
        at org.json.JSONObject.<init>(JSONObject.java:404) ~[json-20230618.jar!/:na]
        at com.example.demo.security.JsonAuthFilter.attemptAuthentication(JsonAuthFilter.java:29) ~[!/:0.0.1-SNAPSHOT]
        at org.springframework.security.web.authentication.AbstractAuthenticationProcessingFilter.doFilter(AbstractAuthenticationProcessingFilter.java:231) ~[spring-security-web-6.2.0.jar!/:6.2.0]
        at org.springframework.security.web.authentication.AbstractAuthenticationProcessingFilter.doFilter(AbstractAuthenticationProcessingFilter.java:221) ~[spring-security-web-6.2.0.jar!/:6.2.0]
        at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374) ~[spring-security-web-6.2.0.jar!/:6.2.0]
        at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:107) ~[spring-security-web-6.2.0.jar!/:6.2.0]
        at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:93) ~[spring-security-web-6.2.0.jar!/:6.2.0]
        at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374) ~[spring-security-web-6.2.0.jar!/:6.2.0]
        at org.springframework.web.filter.CorsFilter.doFilterInternal(CorsFilter.java:91) ~[spring-web-6.1.1.jar!/:6.1.1]
        at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.1.1.jar!/:6.1.1]
        at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374) ~[spring-security-web-6.2.0.jar!/:6.2.0]
```

Notice: the login app redirects to `login` even after successfull authentication. The unnecessary `CustomAuthenticationSuccessHandler` is a failed attempt to solve it. Had enough Java for 2023 thank you very much.